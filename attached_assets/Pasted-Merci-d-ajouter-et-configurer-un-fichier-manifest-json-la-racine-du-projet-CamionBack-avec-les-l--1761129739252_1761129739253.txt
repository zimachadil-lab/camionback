Merci d‚Äôajouter et configurer un fichier manifest.json √† la racine du projet CamionBack avec les √©l√©ments suivants :

{
  "name": "CamionBack",
  "short_name": "CamionBack",
  "description": "R√©servez vos camions de retour √† moindre co√ªt partout au Maroc üá≤üá¶",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#17cfcf",
  "orientation": "portrait",
  "icons": [
    {
      "src": "/icons/icon-192.png",
      "sizes": "192x192",
      "type": "image/png"
    },
    {
      "src": "/icons/icon-512.png",
      "sizes": "512x512",
      "type": "image/png"
    }
  ]
}


Ensuite :
1Ô∏è‚É£ Cr√©e un dossier /icons/ avec deux fichiers PNG du logo CamionBack (couleur #17cfcf) aux tailles 192x192 et 512x512.
2Ô∏è‚É£ Ajoute ce lien dans le <head> du fichier principal HTML :

<link rel="manifest" href="/manifest.json">


3Ô∏è‚É£ V√©rifie que la PWA est bien d√©tect√©e sur Chrome ‚Üí DevTools ‚Üí Application ‚Üí Manifest (elle doit indiquer ‚ÄúInstallable‚Äù).

4Ô∏è‚É£ Le bouton ‚ÄúInstaller CamionBack‚Äù doit automatiquement appara√Ætre sur Android (ou via les trois points ‚Üí ‚ÄúInstaller l‚Äôapp‚Äù).

üîî 2Ô∏è‚É£ Int√©gration Notifications Push via Infobip Push API

Objectif :
Permettre √† CamionBack d‚Äôenvoyer des notifications push (comme une app native) pour avertir les utilisateurs de nouveaux messages, offres, ou validations.

üß† Prompt √† envoyer √† ton agent Replit :

Prompt :

Merci d‚Äôint√©grer la notification push Infobip au projet CamionBack pour afficher des alertes sur t√©l√©phone d√®s qu‚Äôun √©v√©nement important est d√©clench√© (nouvelle offre, validation de commande, message, litige, etc.).

√âtapes techniques √† suivre :

1Ô∏è‚É£ Ajouter un fichier service-worker.js √† la racine du projet contenant :

self.addEventListener("push", (event) => {
  const data = event.data.json();
  const options = {
    body: data.body,
    icon: "/icons/icon-192.png",
    badge: "/icons/icon-192.png",
    vibrate: [200, 100, 200],
    data: { url: data.url || "/" }
  };
  event.waitUntil(self.registration.showNotification(data.title, options));
});

self.addEventListener("notificationclick", (event) => {
  event.notification.close();
  event.waitUntil(clients.openWindow(event.notification.data.url));
});


2Ô∏è‚É£ Enregistrer le Service Worker au chargement de la page principale :

if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/service-worker.js").then(() => {
    console.log("‚úÖ Service Worker enregistr√© pour CamionBack");
  });
}


3Ô∏è‚É£ Connecter Infobip Push API :
Exemple d‚Äôappel API (Node.js ou backend Python) :

import fetch from "node-fetch";

const sendPush = async (deviceToken, title, body, url) => {
  const response = await fetch("https://1g692n.api.infobip.com/push/1/message/advanced", {
    method: "POST",
    headers: {
      "Authorization": "App f6b45bb267ea14ad79e1c30e2e1153f8-a45b17f2-927b-44ea-9ee7-4733bfa74306",
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      messages: [
        {
          destinations: [{ to: deviceToken }],
          notification: {
            title: title,
            body: body,
            clickAction: url
          }
        }
      ]
    })
  });
  console.log(await response.json());
};


4Ô∏è‚É£ Exemple d‚Äôusage :

Quand une offre est accept√©e :
sendPush(deviceToken, "üöõ Offre accept√©e !", "Votre offre vient d‚Äô√™tre valid√©e sur CamionBack.", "/dashboard");

Quand un nouveau message est re√ßu :
sendPush(deviceToken, "üí¨ Nouveau message", "Vous avez un message d‚Äôun client CamionBack.", "/messages");

5Ô∏è‚É£ Ajouter sur chaque compte utilisateur un champ deviceToken pour stocker le token g√©n√©r√© par le navigateur (pushManager.subscribe()).