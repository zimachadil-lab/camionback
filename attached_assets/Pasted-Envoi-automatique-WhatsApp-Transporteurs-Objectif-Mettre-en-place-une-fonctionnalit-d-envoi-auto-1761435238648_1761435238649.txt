Envoi automatique WhatsApp Transporteurs

Objectif :
Mettre en place une fonctionnalitÃ© dâ€™envoi automatique de message WhatsApp via le compte officiel CamionBack (+212664373534) Ã  tous les transporteurs validÃ©s dÃ¨s quâ€™une nouvelle commande est crÃ©Ã©e par un client.

ğŸ§© DÃ©tails fonctionnels

DÃ¨s quâ€™une nouvelle commande est crÃ©Ã©e :

Le systÃ¨me rÃ©cupÃ¨re tous les transporteurs validÃ©s (statut = actif / validÃ©).

Pour chacun, il envoie un message WhatsApp automatique via le compte officiel +212664373534.

ğŸ“ Contenu du message Ã  envoyer

Exemple de message Ã  gÃ©nÃ©rer automatiquement :

ğŸš› *Nouvelle commande disponible sur CamionBack !*

ğŸ“ Ville de dÃ©part : {{ville_depart}}
ğŸ¯ Ville dâ€™arrivÃ©e : {{ville_arrivee}}
ğŸ—“ï¸ Date souhaitÃ©e : {{date}}
ğŸ’° Prix proposÃ© : {{prix}} MAD
ğŸ“¦ Type de marchandise : {{type_colis}}

ğŸ‘‰ Cliquez ici pour voir la commande :
ğŸ”— {{lien_commande}}

Ne laissez pas votre camion revenir Ã  vide !
ğŸŒ www.camionback.com


Le {{lien_commande}} est un lien direct vers la fiche commande (https://camionback.com/commande/{{id}}).

Si le transporteur nâ€™est pas connectÃ©, il sera redirigÃ© vers la page de connexion, puis automatiquement vers la commande.

âš™ï¸ Configuration technique (API WhatsApp / Envoi)

Utiliser le compte WhatsApp Business CamionBack : +212664373534.

MÃ©thode dâ€™envoi : whatsapp-web.js (ou Baileys) reliÃ© au compte Business.

Connexion persistante :

Auth via LocalAuth (QR code scannÃ© une seule fois).

Sauvegarde des credentials pour Ã©viter les reconnexions manuelles.

Si la session se dÃ©connecte â†’ reconnexion automatique.

ğŸ“¡ DÃ©clencheur

Backend : lors de la crÃ©ation dâ€™une commande (POST /api/orders).

Ajouter un hook ou un event listener (onNewOrderCreated) :

RÃ©cupÃ¨re les infos essentielles de la commande.

Formate le message (voir modÃ¨le ci-dessus).

Envoie Ã  la liste des transporteurs validÃ©s.

ğŸ§  Optimisation et SÃ©curitÃ©

Ajouter une petite temporisation entre les envois pour Ã©viter dâ€™Ãªtre bloquÃ© (ex : 1 message / seconde).

Ajouter un log pour suivre les messages envoyÃ©s :

transporteur_id, numÃ©ro, status_envoi (succÃ¨s / Ã©chec), timestamp.

Si un envoi Ã©choue (ex : numÃ©ro invalide), ignorer et poursuivre.

Afficher dans les logs serveur :

âœ… Message envoyÃ© Ã  [Nom transporteur] (+2126...) pour commande CMD-2025-123

ğŸ§­ Vue Admin complÃ©mentaire (facultative mais utile)

Ajouter une rubrique â€œHistorique des notifications WhatsAppâ€ accessible depuis le tableau de bord admin :

Colonnes :

Date dâ€™envoi

NumÃ©ro du transporteur

RÃ©fÃ©rence commande

Statut (succÃ¨s / Ã©chec)

Cela permettra de suivre les envois automatiques.

ğŸ” Gestion dâ€™accÃ¨s

Seuls les transporteurs validÃ©s reÃ§oivent le message.

Si un transporteur est bloquÃ© / en attente de validation, il est exclu.

ğŸ’¡ Bonus (optionnel)

Si possible, ajouter aussi un bouton dans lâ€™interface admin :
[ğŸ“¤ Relancer les transporteurs]
â†’ permet Ã  lâ€™admin de relancer manuellement lâ€™envoi dâ€™une commande prÃ©cise (ex : si elle nâ€™a pas reÃ§u assez dâ€™offres).

RÃ©sultat attendu :

Ã€ chaque nouvelle commande :

Message WhatsApp auto envoyÃ© Ã  tous les transporteurs validÃ©s.

Message structurÃ© et lisible.

Lien cliquable vers la commande.

SystÃ¨me stable, logs visibles, et compatible Android.

NumÃ©ro officiel dâ€™envoi : +212664373534

ğŸ§  Raison de cette fonctionnalitÃ© :
Lâ€™objectif est dâ€™accÃ©lÃ©rer la rÃ©activitÃ© des transporteurs et dâ€™optimiser le taux de remplissage des camions sans nÃ©cessiter de campagne manuelle.